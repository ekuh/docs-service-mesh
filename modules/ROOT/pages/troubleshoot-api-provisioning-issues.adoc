= Troubleshoot API Provisioning Issues
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:keywords: service mesh, microservices, API provisioning issues, troubleshooting

After you provision an adapter, you must create an API, to which you then bind the service. You encounter errors when you provision an API if you provide invalid credentials.

== Client Secret is Incorrectly Configured

If using a secret when you create an API, you must verify that you are correctly referencing the secret.

=== Cause

If you provide incorrect credentials, the following error occurs:

image::credentials-error-api-prov-service-mesh.png[Credentials error when provisioning APIs]

=== Diagnosis

To diagnose the issue:

. Describe your service instance using the `kubectl describe serviceinstance _api_instance_name_` command:
+
`$ kubectl describe serviceinstance inventory-resource-api`
In the `Status` field, a detailed description of the error is displayed:
+
image::error-with-params-error-display-api-prov-service-mesh.png[Error with parameters when provisioning APIs]

In the following example, an error occurred due to an extra comma in the stringData section that is provided after the password segment:

[source,text,linenums]
----
apiVersion: v1
kind: Secret
metadata:
  name: my-credentials
  namespace: nto-payment
type: Opaque
stringData:
  user-pass:
    '{
      "user": "<user>",
      "password": "<password>",
    }'
----

=== Solution

To resolve this issue:

. Delete the API.
. Resolve the username and password error.
. Re-create the API.  

[[api-spec-file-size-exceeded]]
== API Specification File Exceeds Supported Size

When provisioning an API with a specification file that is larger than 550 KBs, you might encounter issues with the provision operation or the Service Mesh services.

=== Cause

If you use a large file, the pods might be restarted due to insufficient memory or crashloop errors:

[source,text,linenums]
----
E0605 21:13:58.080886       1 controller_instance.go:1968] ServiceInstance "default/flights-api-v1" v8611662: Failed to update status: rpc error: code = ResourceExhausted desc = trying to send message larger than max (2554151 vs. 2097152)
I0605 21:13:58.080907       1 controller.go:408] Dropping ServiceInstance "default/flights-api-v1" out of the queue: rpc error: code = ResourceExhausted desc = trying to send message larger than max (2554151 vs. 2097152)
----

=== Diagnosis

To diagnose the issue:

. Check the status of the Service Catalog pods:
+
`$ kubectl get pods -n service-mesh`
+ 
If a status other than `Running` is displayed , the Service Catalog pods might be failing due to lack of resources. 
+
. If the pod is running correctly, check the logs for `rpc` errors:
+
`$ kubectl logs -f deployment/service-mesh-catalog-controller-manager -n service-mesh --tail=250 | grep "rpc error"`

=== Solution

To resolve this issue:

. If Service Catalog pods are failing, increase their resource limits:
+
`$ kubectl -n service-mesh set resources deployment service-mesh-catalog-controller-manager --limits=memory=64Mi`
+
`$ kubectl -n service-mesh set resources deployment service-mesh-catalog-webhook --limits=memory=64Mi`
. Delete the service instance.
. Create the API from Anypoint Platform.

